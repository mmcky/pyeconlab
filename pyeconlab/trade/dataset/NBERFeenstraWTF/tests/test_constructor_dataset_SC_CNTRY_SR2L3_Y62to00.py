"""
Test Dataset: SC_CNTRY_SR2L3_Y62to00 from NBERFeenstraWTFConstructor
	
	dropAX 			: 	Drop AX Codes 
	sitcr2 			: 	Add SITCR2 Indicator
	drop_nonsitcr2 	: 	Drop non-standard SITC2 Codes
	report 			: 	Print Report
	source_institution : which institutions SITC classification to use

Datasets
--------
A => dropAX=False, sitcr2=False, drop_nonsitcr2=False
B => dropAX=True, sitcr2=True, drop_nonsitcr2=True

Stata Test Data
---------------
[1] Generated by ..\do\basic_sitc3_country_data.do

Future Work 
-----------
[1] Change TEST_DATA_DIR to a non hard linked reference. How do package this data?

"""

TEST_DATA_DIR 	= "E:\\work-data\\repos-pyeconlab-testdata\\" 
SOURCE_DATA_DIR = "E:\\work-data\\x_datasets\\36a376e5a01385782112519bddfac85e\\" #win7

import pandas as pd
from numpy.testing import assert_allclose

from pyeconlab import NBERFeenstraWTFConstructor

class TestSC_CNTRY_SR2L3_Y62to00():
	"""
	Test Suite for SC_CNTRY_SR2L3_Y62to00 Datasets A and B
	
	Settings
	--------
	A => dropAX=False, sitcr2=False, drop_nonsitcr2=False
	B => dropAX=True, sitcr2=True, drop_nonsitcr2=True

	Stata Produced Files
	--------------------
	A-nberfeenstra_do_stata_sitc3_country_data.log
	A-nberfeenstrawtf_do_stata_basic_country_sitc3_bilateral.dta
	B-nberfeenstra_do_stata_sitc3_country_data.log
	B-nberfeenstrawtf_do_stata_basic_country_sitc3_bilateral.dta
	"""
	
	@classmethod
	def setUpClass(cls):
		cls.a = NBERFeenstraWTFConstructor(source_dir=SOURCE_DATA_DIR)

	def setUp(self):
		self.a.reset_dataset()

	def test_bilateral_data_A(self):
		#-pyeconlab-#
		self.a.construct_dataset_SC_CNTRY_SR2L3_Y62to00_A()
		#-stata-#
		self.A = pd.read_stata(TEST_DATA_DIR + 'A-nberfeenstrawtf_do_stata_basic_country_sitc3_bilateral.dta')
		self.A = self.A.sort(['year', 'eiso3c', 'iiso3c', 'sitc3'])
		self.A = self.A.reset_index()
		del self.A['index']
		assert_allclose(self.a.dataset['value'].values, self.A['value'].values)

	def test_bilateral_data_B(self):
		#-pyeconlab-#
		self.b.construct_dataset_SC_CNTRY_SR2L3_Y62to00_B()
		#-stata-#
		self.B = pd.read_stata(TEST_DATA_DIR + 'B-nberfeenstrawtf_do_stata_basic_country_sitc3_bilateral.dta')
		self.B = self.B.sort(['year', 'eiso3c', 'iiso3c', 'sitc3'])
		self.B = self.B.reset_index()
		del self.B['index']
		assert_allclose(self.b.dataset['value'].values, self.B['value'].values)

		

